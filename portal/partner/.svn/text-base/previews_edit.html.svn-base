<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Partner Portal - Edit Previews</title>
	<link rel="stylesheet" type="text/css" href="../../public/css/global.css" media="all">
</head>

<body>
	<div id="wrapper">
		<!-- Logo and Logged-In User Links -->
		<fieldset class="global_logo_container">
			<h1>Qualcomm</h1>
			<p class="global_status_content">
				username@email.com
			</p>
			<ul class="user_links_container">
				<li><a href="#">Sign Out</a></li>
				<li class="div">|</li>
				<li><a href="my_profile.html">My Profile</a></li>
			</ul>
		</fieldset>
		<!-- /Logo and Logged-In User Links -->
		
		<!-- Top Navigation -->
		<ul class="global_nav">
			<li class="active"><a href="titles.html">Titles</a></li>
			<li><a href="agreements.html">AGREEMENTS</a></li>
			<li class="last"><a href="admin.html">Admin</a></li>
		</ul>
		<!-- /Top Navigation -->
		
		<!-- Main Content -->
		<div id="form_container" class="create_account_container">
			<div class="form_block expose_target corner_8">
				
				<div class="form_header">
					<h3 id="titleid">EDIT PREVIEWS</h3>					
				</div>
				<form id="form_33863" class="appnitro add_previews_container" enctype="multipart/form-data" method="post" action="">																	
					<div class="demo-description">			
						<fieldset class="add_images_container">
							<legend class="info_icon_container">
								Currently this preview set has been associated with one or more submitted binaries. At least one preview image is required.
							</legend>
							<input type="hidden" id="displayid" name="displayId" value="2">
							<input type="hidden" id="position" name="position" value="1">
							<input type="hidden" id="touch" name="touch" value="true">
							<input type="hidden" id="width" name="width" value="512">
							<input type="hidden" id="height" name="height" value="512">
							<div class="add_images_content">
								<ul>
								<div id="sortable" >
									<li class="edit_image_preview">
										<div id="image1" name="file" class="edit image_block">
											<a id="deletepreviewlink1" class="preview_delete">DELETE</a>
											<img src='../images/blank.gif' id="previewdisplay1" class="preview_img">
											<p class="click_content">Click to choose file</p>
										</div>
										<input skip="no" id="file1" name="file" class="element file" type="file" size="1" style="display: none;"/>
									</li>
									<li class="edit_image_preview">										
										<div id="image2" name="file" class="edit image_block">
											<a id="deletepreviewlink2" class="preview_delete">DELETE</a>
											<img src='../images/blank.gif' id="previewdisplay2" class="preview_img">
											<p class="click_content">Click to choose file</p>
										</div>
										<input skip="yes" id="file2" name="file" class="element file" type="file" size="1" style="display: none;"/>
									</li>
									<li class="edit_image_preview">										
										<div id="image3" name="file" class="edit image_block">
											<a id="deletepreviewlink3" class="preview_delete">DELETE</a>
											<img src='../images/blank.gif' id="previewdisplay3" class="preview_img">
											<p class="click_content">Click to choose file</p>
										</div>
										<input skip="yes" id="file3" name="file" class="element file" type="file" size="1" style="display: none;"/>
									</li>
									<li class="edit_image_preview">										
										<div id="image4" name="file" class="edit image_block">
											<a id="deletepreviewlink4" class="preview_delete">DELETE</a>
											<img src='../images/blank.gif' id="previewdisplay4" class="preview_img">
											<p class="click_content">Click to choose file</p>
										</div>
										<input skip="yes" id="file4" name="file" class="element file" type="file" size="1" style="display: none;"/>
									</li>
									<li class="edit_image_preview">										
										<div id="image5" name="file" class="edit image_block">
											<a id="deletepreviewlink5" class="preview_delete">DELETE</a>
											<img src='../images/blank.gif' id="previewdisplay5" class="preview_img">
											<p class="click_content">Click to choose file</p>
										</div>
										<input skip="yes" id="file5" name="file" class="element file" type="file" size="1" style="display: none;"/>
									</li>
									</div>
								</ul>
							</div>							
							<p>
								(Drag and drop to change the order)
							</p>
						</fieldset>
								
					</div>
					<!-- End demo-description -->
										
					<div class="buttons_container stroke_top">					
						<a href="titles.html">Cancel</a>
						<input id="saveForm" class="button_gen button_form corner_4" type="button" name="submit" value="Save" disabled="disabled" skip="yes" />																		
					</div>										
				</form>	
			</div>
		</div>		
	</div>

	<script type="text/javascript" src="../../public/js/jquery.1.4.4.min.js"></script>
	<script type="text/javascript" src="../../public/js/jquery-ui-1.8.7.custom.min.js"></script>
	<script type="text/javascript" src="../../public/js/jquery.validate.1.0.min.js"></script>
	<script type="text/javascript" src="../../public/js/jquery.cookie.js"></script>
	<script type="text/javascript" src="../../public/js/jquery.ae.image.resize.min.js"></script>
	<script type="text/javascript" src="../../public/js/ajaxfileupload.js"></script>
	<script type="text/javascript" src="../../public/js/flexigrid.js"></script>
	<!-- <script type="text/javascript" src="../../public/js/flexigrid2.js"></script> -->
	<script type="text/javascript" src="../../public/js/json.js"></script>
	<script type="text/javascript" src="../../public/js/global.js"></script>

	<script type="text/javascript">
	$(function() {
		$( "#sortable" ).sortable({
		});
	});
</script>

<style>

	
#draggable1 { width: 150px; height: 35px; padding: 0.5em; }
#draggable2 { width: 150px; height: 35px; padding: 0.5em; }
#draggable3 { width: 150px; height: 35px; padding: 0.5em; }

#sortable { width: 700px; height: 35px; padding: 0.5em; }

#sortable > div { float: left; }	
</style>

<script type="text/javascript">
/*	
$(function() {
	$("#selectable").selectable({
		stop: function(){
			var result = $("#select-result").empty();
			$(".ui-selected", this).each(function(){
				var index = $("#selectable li").index(this);
				
				if(index > -1){
					result.append(" #" + (index+1));
					
					selectedName = name[index];
					selectedDisplayId = displayId[index];
					selectedPosition = position[index];
					selectedHeight = height[index];
					selectedWidth = width[index];
					
					//var touch = (typeof(data.result[i].touch) == "undefined") ? "Non-touch": data.result[i].touch;
					selectedTouch = touch[index];

//					result.append("<br/> name: " + selectedName );
//					result.append("<br/> displayId: " + selectedDisplayId );
//					result.append("<br/> height: " + selectedHeight );
//					result.append("<br/> width: " + selectedWidth );
//					result.append("<br/> AspectRatio (Position): " + selectedPosition );
					//if(	 flag_file_upload  ){
						$('#saveForm').removeAttr('disabled');
					//}
					$('#displayid').val(selectedDisplayId);
					$('#touch').val(selectedTouch);
					$('#width').val(selectedWidth);
					$('#height').val(selectedHeight);
						
				}					
			});
		}
	});
});*/
</script>
 
<script type="text/javascript">

	var name = new Array();
	var displayId = new Array();
	var position = new Array();
	var touch = new Array();
	var height = new Array();
	var width = new Array();
	
	var selectedDisplayId = '';
	var titleid = "";
	var numpreviews=0;
	var previewImageIds = new Array();

	$(document).ready(function() {

		$.urlParamDisplayId = function(name){
			var results = new RegExp('[\\?]' + name + '=([^&#]*)').exec(window.location.href);
			if (!results) { return 0; }
		
			return results[1] || 0;
		}
		
		$.urlParam = function(name){
			var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
			if (!results) { return 0; }
		
			return results[1] || 0;
		}
	
		var url = getBaseURL() + getPartnerAppURL() + $.urlParam('d');
		$.getJSON(url, function(data){
			$('#titleid').text('Edit Previews - ' + data.result.name);
			titleid = data.result.id;

		if(data.result.previewCollateralUrl)												 // PREVIEWS
			{
			var imgs = '<br><br>';	
			var i;
			var j;
			$.getJSON(getBaseURL() + urlAfterInclusive(String(data.result.previewCollateralUrl.url.href),'/partner'), function(data2)
				{
				if(data2) // there can be multiple previews here
					{
					for(i in data2.result)
						{
							// synchronous -- too many calls were aborting.
							if(data2.result[i].displayId == $.urlParamDisplayId('displayid')){
								
								$.ajax({
								    type: 'GET',
								    url: getBaseURL() + urlAfterInclusive(String(data2.result[i].url.href),'/partner'),
								    dataType: 'json',
								    success: function(data3) 
									{
									if(data3) // can there be multiple previews here??
										{
										for(j in data3.result)
											$('#previewdisplay' + data3.result[j].position).attr('src',getBaseURL() + urlAfterInclusive(String(data3.result[j].url.href),'/partner'));
											
											previewImageIds.push(getBaseURL() + urlAfterInclusive(String(data3.result[j].url.href),'/partner'));
										}		
						
								 	},
								    async: false
								});
							}
						}
					}
				
				});
			
			}

			
		});
		
		//DISPLAYS
		$.getJSON( getBaseURL() + getPartnerAppURL() + '/displays', function(data){
		    var html = '';
		    var len = data.result.length;
			
			$.urlParamDisplayId('displayid');

		    for (var i = 0; i < len; i++) {
				
				if (data.result[i].id == $.urlParamDisplayId('displayid')) {
					touch[i] = (typeof(data.result[i].touch) == "undefined") ? "Non-touch" : data.result[i].touch;
					$('#displayid').val(data.result[i].id);
					$('#touch').val(touch[i]);
					$('#width').val(data.result[i].pixelWidth);
					$('#height').val(data.result[i].pixelHeight);
				}
			}
		    $('#selectable').append(html);			
			
		});


    function ajaxFileUpload(previewurl)
    {
        //starting setting some animation when the ajax starts and completes
        $("#loading")
        .ajaxStart(function(){
            $(this).show();
        })
        .ajaxComplete(function(){
            $(this).hide();
        });
       
        /*
            prepareing ajax file upload
            url: the url of script file handling the uploaded files
                        fileElementId: the file type of input element id and it will be the index of  $_FILES Array()
            dataType: it support json, xml
            secureuri:use secure protocol
            success: call back function when the ajax complete
            error: callback function when the ajax failed
        */
		//post
		// var previewData = 'file=' + $('#file1').val() + '&displayId=' + selectedDisplayId + '&position=1' +  '&touch=' + selectedTouch +  '&height=' + selectedHeight + '&width=' + selectedWidth ;

		// var previewData = '{"file":' + $('#file1').val() + ',"displayId":' + selectedDisplayId + ',"position":1' +  ',"touch":' + selectedTouch +  ',"height":' + selectedHeight + ',"width":' + selectedWidth + '}' ;

        $.ajaxFileUploadWholeForm
        (
 
            {
                url:previewurl,
		type:'POST',
                secureuri:false,
                fileElementId:'file1',
                // dataType: 'json',
		//		data: previewData,
                success: function (data, status)
                {
		//	alert("Preview Upload Successful.");
		//	window.location = "titles.html";
			//alert("Previews left: " + numpreviews);
			confirmRedirect("Previews left: " + numpreviews , "noRedirect");
			numpreviews--;
                },
                error: function (data, status, e)
                {
                    //alert(e);
					confirmRedirect(e , "noRedirect");
                }
            },'form_33863'
        )
        
        return false;
	
    }  
	
	$('#image1').click(function()
		{
			document.getElementById('file1').style.display='';
			$('#saveForm').removeAttr('disabled');
		}
	);
	$('#image2').click(function()
		{
			document.getElementById('file2').style.display='';
				$('#saveForm').removeAttr('disabled');
		}
	);
	$('#image3').click(function()
		{
			document.getElementById('file3').style.display='';
			$('#saveForm').removeAttr('disabled');
		}
	);
	$('#image4').click(function()
		{
			document.getElementById('file4').style.display='';
			$('#saveForm').removeAttr('disabled');
		}
	);
	$('#image5').click(function()
		{
			document.getElementById('file5').style.display='';
			$('#saveForm').removeAttr('disabled');

		}
	);

	var deleteImage1 = false;
	var deleteImage2 = false;
	var deleteImage3 = false;
	var deleteImage4 = false;
	var deleteImage5 = false;
	
	$('#deletepreviewlink1').click(function()
	{
		deleteImage1 = true;
		$('#saveForm').removeAttr('disabled');
		
	});
	$('#deletepreviewlink2').click(function()
	{
		deleteImage2 = true;
		$('#saveForm').removeAttr('disabled');

	});
	$('#deletepreviewlink3').click(function()
	{
		deleteImage3 = true;
		$('#saveForm').removeAttr('disabled');

	});
	$('#deletepreviewlink4').click(function()
	{
		deleteImage4 = true;
		$('#saveForm').removeAttr('disabled');

	});
	$('#deletepreviewlink5').click(function()
	{
		deleteImage5 = true;
		$('#saveForm').removeAttr('disabled');

	});

	function deleteImage(imageUrl){

		$.ajax({url: imageUrl ,type:'DELETE'}); // 
		//alert("Preview Deleted");
		confirmRedirect("Preview Deleted" , "noRedirect");
	}

	$('#saveForm').click(function()
		{

			if(deleteImage1 && previewImageIds[0].length>0){
				deleteImage(previewImageIds[0]);
			}
			if(deleteImage2 && previewImageIds[1].length>0){
				deleteImage(previewImageIds[1]);
			}
			if(deleteImage3 && previewImageIds[2].length>0){
				deleteImage(previewImageIds[2]);
			}
			if(deleteImage4 && previewImageIds[3].length>0){
				deleteImage(previewImageIds[3]);
			}
			if(deleteImage5 && previewImageIds[4].length>0){
				deleteImage(previewImageIds[4]);
			}

			var i;
			for(i=1; i < 6; i++)
				{
				$('.file').attr("skip","yes")
				$('#file'+i).attr("skip","no")
				if($('#file'+i).val().length>0)
					{
					numpreviews++;
					$('#position').val(i);	
					ajaxFileUpload(getBaseURL() + getPartnerAppURL() + '/publishers/' + getPublisherId() + '/titles/' + titleid + '/previews');
					}
				}
			$('#saveForm').removeAttr('disabled');

			setTimeout(function()
				{ 
				if(numpreviews==0) 
					{
					//alert("File(s) Uploaded Successfully.");
					//window.location = "title_details.html?d=" + $.urlParam('d');
					confirmRedirect("File(s) Uploaded Successfully." , "title_details.html?d=" + $.urlParam('d'));
					}

			 	}, 1000);

							

		});
		
		/* jQuery overlay append */
		var overlayHeight = $(document).height();
		var overlayHTML = "<div class='container_fullscreen' style='height:" + overlayHeight + "px;'>&nbsp;</div>";
		$('body').append(overlayHTML);
	
	
	});

</script>	
 
 
</body>
</html>